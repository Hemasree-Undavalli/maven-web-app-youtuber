pipeline {
    agent any 
    stages {
        stage ('git clone ') {
            steps {
                git 'https://github.com/koteswararao73/maven-web-app-youtuber.git'
            }
        }
        stage ('maven compile') {
            steps {
                sh ''' mvn compile '''
            }
        }
        stage ('maven test') {
            steps {
                sh ''' mvn test '''
            }
        }
        stage ('mvn package') {
            steps {
                sh 'mvn package'
            }
        }
        stage ('build the image') {
            steps {
                sh ''' docker build -t goutham . '''
            }
        }
        stage ('give the tag ') {
            steps {
                    sh 'docker tag goutham koteswarararaosairi/goutham12:v1'
            }
        }
        stage ('push the image') {
            steps {
                 script {
                     withDockerRegistry(credentialsId: 'dockerhub') {
                         sh 'docker push koteswarararaosairi/goutham12:v1'
                     }
                 }
            }
        }
        stage ('pull the image') {
            steps {
                sh 'docker pull koteswarararaosairi/goutham12:v1'
            }
        }
        stage ('run a conatiner') {
            steps {
                sh 'docker run --name koti -d -p 8086:8080 koteswarararaosairi/goutham12:v1'
            }
        }
    }
}
